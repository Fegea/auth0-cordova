# Auth0 Cordova

## Setup

Copy the contents of this library to your project in a folder named `auth0-cordova`.

> This library is written with JS ES6 so you might need to configure babel to transpile it to ES5 if you haven't done it for your app.

Then, since the library requires these two cordova plugins to work:

- cordova-plugin-safariviewcontroller: Shows Safari/Chrome browser ViewController/CustomTab
- cordova-plugin-customurlscheme: Handles the custom scheme url intents for callback

you'll need to run 

```bash
cordova plugin add cordova-plugin-inappbrowser
cordova plugin add cordova-plugin-customurlscheme --variable URL_SCHEME={application package name} --variable ANDROID_SCHEME={application package name} --variable ANDROID_HOST={auth0 domain} --variable ANDROID_PATHPREFIX=/cordova/{application package name}/callback
```

> In cordova applications, the application package name is the widget's id in the file `config.xml`

So if you have the following values

* application package name: com.auth0.cordova.example
* auth0 domain: samples.auth0.com

in your config you should have some entries like 

```xml
<plugin name="cordova-plugin-customurlscheme" spec="~4.2.0">
    <variable name="URL_SCHEME" value="com.auth0.cordova.example" />
    <variable name="ANDROID_SCHEME" value="com.auth0.cordova.example" />
    <variable name="ANDROID_HOST" value="sample.auth0.com" />
    <variable name="ANDROID_PATHPREFIX" value="/cordova/com.auth0.cordova.example/callback" />
</plugin>
<plugin name="cordova-plugin-safariviewcontroller" spec="~1.4.6" />
```

then in your index.js you need to register the url handler `ondeviceready`

```js
import Auth0Cordova from './auth0-cordova';

function main() {
    function intentHandler(url) {
        Auth0Cordova.onRedirectUri(url);
    }
    window.handleOpenURL = intentHandler;
    // init your application
}

document.addEventListener('deviceready', main);
```

and to use is as simple as

```js
const client = new Auth0Cordova({
  clientId: "{auth0 client id}",
  domain: "{auth0 domain}",
  packageIdentifier: "{application package name}"
});

const options = {
  scope: 'openid profile',
};

client.authorize(options, function (err, authResult) {
  if (err) {
    // failure
  }
  // success!
});
```

## API 

### new Auth0Cordova(options)

Initializes a new instance of `Auth0Cordova` configured with the `options` objects whose properties are defined as follows

- **clientId {String}**: Your application clientId in Auth0.
- **domain {String}**: Your Auth0 domain. Usually your-account.auth0.com.
- **packageIdentifier {String}** Your applications package identifier this is usually found as the "id" attribute on <widget> element in your config.json 

### authorize(options, callback)

Initiates the options process by opening the hosted login page in the native system browser. The 


- **options{object}**: Object accepts all the parameters taken by Auth0.js' [buildAuthorizeUrl method](https://github.com/auth0/auth0.js#api-1) except for `code_challenge_method`, `responseCode`, `redirectUri` and `code_challenge` these are generated by the library.
- **callback{function}**: A callback function which will be called at the end of the authentication attempt with error or `null` as the first argument and `authResult` as the second argument. The contents of `authResult` are the same as the contents returned by Auth0.js' WebAuth's [parseHash](https://github.com/auth0/auth0.js#auth0webauth)


## TODO

- [x] state verification
- [ ] use custom error
- [ ] better error handling in public API
- [ ] validate parameters of functions
- [ ] unit tests
- [ ] fetch package identifier automatically
- [ ] make it a cordova plugin
- [ ] configure variables on plugin install